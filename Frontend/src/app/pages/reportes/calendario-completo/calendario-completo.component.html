<div class="w-full max-w p-6">
  <!-- Selector de año -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:gap-4 mb-6">
    <label for="anio" class="font-semibold text-gray-700 mb-2 sm:mb-0">Seleccionar año:</label>
    <input
      id="anio"
      type="number"
      min="2000"
      max="2100"
      [(ngModel)]="anioSeleccionado"
      (change)="cargarDatos()"
      class="border border-gray-300 rounded-md p-2 w-32 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"
      placeholder="2024"
      aria-label="Seleccionar año"
    />
  </div>
  
  <button
  (click)="exportarCalendarioPDF()"
  class="mt-4 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
  >
  Exportar PDF
  </button>

  <!-- Mensaje si no hay datos -->
  <div *ngIf="sinDatos" class="text-center text-gray-500 italic text-lg py-12">
    <i class="fas fa-info-circle mr-2"></i> No hay movimientos registrados para este año.
  </div>


  <!-- Calendario -->
  <div id="contenedor-calendario" *ngIf="!sinDatos" class="w-full border border-gray-300 rounded-lg shadow-inner overflow-x-auto">
    <h1 class="text-2xl font-bold mb-4 tracking-wide">
      Planificación de Vacaciones - {{ anioSeleccionado }}
    </h1>
    <table class="min-w-full text-sm text-center border-collapse">
      <thead class="bg-indigo-50 sticky top-0 z-20">
        <tr>
          <th class="border sticky w-[140px] border-gray-300 px-3 py-2 text-lef left-0 bg-indigo-50 z-30 shadow-md">Trabajador</th>
          <th class="border sticky left-[140px] w-[80px]  border-gray-300 px-2 py-2">Progresivos</th>
          <th class="border sticky left-[220px] w-[100px] border-gray-300 px-2 py-2">Pendientes</th>
          <th class="border sticky left-[300px] w-[80px] border-gray-300 px-2 py-2">Total</th>
          <th class="border sticky left-[380px] w-[80px] border-gray-300 px-2 py-2">Pedidos</th>
          <th class="border sticky left-[460px] w-[80px] border-gray-300 px-2 py-2">Saldo</th>
          <th
            *ngFor="let dia of diasCalendario"
            class="border border-gray-300 px-2 py-2 whitespace-nowrap select-none"
            scope="col"
            title="{{ dia | date:'fullDate' }}"
          >
            <div class="flex flex-col items-center">
              <span class="font-semibold text-indigo-700">{{ diaMes(dia) }}</span>
              <span class="text-xs text-gray-400">{{ nombreMes(dia) }}</span>
            </div>
          </th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let trabajador of trabajadores; let i = index">
          
          <!-- Encabezado de familia (opcional) -->
          <tr *ngIf="i === 0 || getFamiliaCargo(trabajadores[i - 1].cargo) !== getFamiliaCargo(trabajador.cargo)">
            <td colspan="999" class="bg-gray-100 text-left text-sm font-semibold px-4 py-2 uppercase tracking-wide">
            </td>
          </tr>
      
          <!-- Fila del trabajador -->
          <tr class="hover:bg-indigo-50 transition-colors">
            <td class="border border-gray-300 px-3 py-2 text-left whitespace-nowrap font-medium bg-white z-10 shadow-sm sticky left-0">
              {{ trabajador.nombre }}
            </td>
            <td class="border sticky left-[140px] w-[80px] text-gray-500 font-semibold border-gray-300 px-2 py-2">{{ progresivosPorRut[trabajador.rut] ?? '-' }}</td>
            <td class="border sticky left-[220px] w-[100px] text-gray-500 font-semibold border-gray-300 px-2 py-2">{{ pendientesPorRut[trabajador.rut] ?? '-' }}</td>
            <td class="border sticky left-[300px] w-[80px] text-gray-500 font-semibold border-gray-300 px-2 py-2">{{ totalPorRut[trabajador.rut] ?? '-' }}</td>
            <td class="border sticky left-[380px] w-[80px] text-gray-500 font-semibold border-gray-300 px-2 py-2">{{ pedidosPorRut[trabajador.rut] ?? '-' }}</td>
            <td class="border sticky left-[460px] w-[80px] text-gray-500 font-semibold border-gray-300 px-2 py-2">{{ saldoPorRut[trabajador.rut] ?? '-' }}</td>
            <td
              *ngFor="let dia of diasCalendario"
              class="border border-gray-300 px-2 py-2"
              [ngClass]="tieneVacacionesEn(dia, trabajador) ? getColorPorCargo(trabajador.cargo) + ' text-white font-bold' : 'text-gray-700'"
            >
              <span class="inline-block w-5 h-5 leading-5 text-gray-500 font-semibold">
                {{ numerosVacacionesPorTrabajador[trabajador.rut]?.[formatoFecha(dia)] || '' }}
              </span>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>